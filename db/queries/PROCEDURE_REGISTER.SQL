DELIMITER //
DROP PROCEDURE IF EXISTS REGISTER;
CREATE PROCEDURE REGISTER(
    IN P_NAME VARCHAR(255),
    IN P_USERNAME VARCHAR(255),
    IN P_PASSWORD VARCHAR(255),
    IN P_EMAIL VARCHAR(255),
    OUT P_SUCCESS BOOLEAN
)
BEGIN
    DECLARE EXISTING_USER_COUNT INT;

    SELECT COUNT(*)
    INTO EXISTING_USER_COUNT
    FROM USERS
    WHERE USERNAME = P_USERNAME;

    IF EXISTING_USER_COUNT > 0 THEN
        SET P_SUCCESS = FALSE;
    ELSE
        INSERT INTO USERS (NAME, USERNAME, PASSWORD, EMAIL)
        VALUES (P_NAME, P_USERNAME, P_PASSWORD, P_EMAIL);
        SET P_SUCCESS = TRUE;
    END IF;
END;
DELIMITER ;