DELIMITER //
DROP PROCEDURE IF EXISTS SHOW_POSTS;
CREATE PROCEDURE SHOW_POSTS(IN P_ID_HILO INT)
BEGIN
    DECLARE DONE INT DEFAULT 0;
    DECLARE POST_ID INT;
    DECLARE USER_NAME VARCHAR(255);
    DECLARE POST_CONTENT TEXT;
    DECLARE FECHA_CREACION TIMESTAMP;
    DECLARE FECHA_EDICION TIMESTAMP;

    DECLARE POST_CURSOR CURSOR FOR
        SELECT POSTS.ID_POST, USERS.USERNAME, POSTS.CONTENIDO, POSTS.FECHA_CREACION, POSTS.FECHA_EDICION
        FROM POSTS
                 INNER JOIN USERS ON POSTS.USER_ID = USERS.USER_ID
        WHERE POSTS.ID_HILO = P_ID_HILO
        ORDER BY POSTS.FECHA_CREACION;

    DECLARE CONTINUE HANDLER FOR NOT FOUND SET DONE = TRUE; -- Esto es para decir que el cursor no va a retornar nada

    OPEN POST_CURSOR;

    READ_LOOP:
    LOOP
        FETCH POST_CURSOR INTO POST_ID, USER_NAME, POST_CONTENT, FECHA_CREACION, FECHA_EDICION;
        IF DONE THEN
            LEAVE READ_LOOP;
        END IF;
        SELECT POST_ID, USER_NAME, POST_CONTENT, FECHA_CREACION, FECHA_EDICION;
    END LOOP;

    CLOSE POST_CURSOR;
END;
DELIMITER ;