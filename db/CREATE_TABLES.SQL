CREATE DATABASE ASYNCORE;

USE ASYNCORE;

CREATE TABLE TIPO_USUARIO (
    ID_TIPO INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(255),
    CONSTRAINT CHK_ID_TIPO CHECK(ID_TIPO IN 1, 2, 3)
);

CREATE TABLE USERS (
    USER_ID INT AUTO_INCREMENT PRIMARY KEY,
    USERNAME VARCHAR(255) NOT NULL,
    PWD VARCHAR(255) NOT NULL,
    EMAIL VARCHAR(255) NOT NULL,
    FECHA_REGISTRO TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    AVATAR VARCHAR(255),
    FIRMA VARCHAR(255),
    TIPO_USUARIO INT DEFAULT 2,
    CONSTRAINT FK_USERS_ID_TIPO FOREIGN KEY(TIPO_USUARIO)
            REFERENCES TIPO_USUARIO(ID_TIPO)-- 1 ADMIN 2 PROFESOR 3 ALUMNO
);

CREATE TABLE CATEGORIA (
    ID_CATEGORIA INT AUTO_INCREMENT PRIMARY KEY,
    TITULO VARCHAR(255) NOT NULL,
    SUBTITULO VARCHAR(255) NOT NULL,
    ICONO VARCHAR(255) DEFAULT NULL
);

CREATE TABLE HILOS (
    ID_HILO INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID INT NOT NULL,
    TITULO VARCHAR(255) NOT NULL,
    CONTENIDO TEXT NOT NULL,
    FECHA_CREACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FECHA_EDICION TIMESTAMP DEFAULT 0 ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_HILOS_USER_ID FOREIGN KEY (USER_ID)
            REFERENCES USERS(USER_ID),
    CONSTRAINT FK_HILOS_ID_CATEGORIA FOREIGN KEY (ID_CATEGORIA)
            REFERENCES CATEGORIA(ID_CATEGORIA)
);

CREATE TABLE ETIQUETAS (
    ID_ETIQUETA INT AUTO_INCREMENT PRIMARY KEY,
    NOMBRE VARCHAR(255) NOT NULL,
    DESCRIPCION VARCHAR(255) NOT NULL
);

CREATE TABLE POSTS (
    ID_POST INT AUTO_INCREMENT PRIMARY KEY,
    ID_HILO INT NOT NULL,
    USER_ID INT NOT NULL,
    CONTENIDO TEXT NOT NULL,
    FECHA_CREACION TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FECHA_EDICION TIMESTAMP DEFAULT 0 ON UPDATE CURRENT_TIMESTAMP,
    CONSTRAINT FK_POSTS_ID_HILO FOREIGN KEY (ID_HILO)
            REFERENCES HILOS(ID_HILO),
    CONSTRAINT FK_POSTS_USER_ID FOREIGN KEY (USER_ID)
            REFERENCES USERS(USER_ID),
    CONSTRAINT FK_POSTS_ID_ETIQUETA FOREIGN KEY (ID_ETIQUETA)
            REFERENCES ETIQUETAS(ID_ETIQUETA)
);

CREATE TABLE POST_ETIQUETAS (
    ID_POST INT NOT NULL,
    ID_ETIQUETA INT NOT NULL,
    CONSTRAINT FK_POST_ETIQUETAS_ID_POST FOREIGN KEY (ID_POST)
            REFERENCES POSTS(ID_POST),
    CONSTRAINT FK_POST_ETIQUETAS_ID_ETIQUETA FOREIGN KEY (ID_ETIQUETA)
            REFERENCES ETIQUETAS(ID_ETIQUETA)
);